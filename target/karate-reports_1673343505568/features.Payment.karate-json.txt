{"failedCount":1,"prefixedPath":"classpath:features\/Payment.feature","packageQualifiedName":"features.Payment","loopIndex":-1,"relativePath":"features\/Payment.feature","scenarioResults":[{"sectionIndex":0,"stepResults":[{"result":{"nanos":40368800,"millis":40.3688,"status":"passed"},"step":{"background":true,"line":3,"prefix":"*","index":0,"text":"configure headers = { \"X-LP-AUTOTEST-NAME\": \"features\/Payment.feature\" }"}},{"result":{"nanos":71717400,"millis":71.7174,"status":"passed"},"step":{"background":true,"line":5,"prefix":"*","index":1,"text":"def baseURI = \"http:\/\/api-pay.line-apps-beta.com:8080\""}},{"result":{"nanos":684800,"millis":0.6848,"status":"passed"},"step":{"background":true,"line":7,"prefix":"*","index":2,"text":"def paymentsBaseURI = \"https:\/\/api-pay.line-beta.me:443\""}},{"result":{"nanos":693800,"millis":0.6938,"status":"passed"},"step":{"comments":["# 계정 정보"],"background":true,"line":10,"prefix":"*","index":3,"text":"def mid = \"u00d5f3a707a98b67e13f342c8530601a\""}},{"result":{"nanos":1643900,"millis":1.6439,"status":"passed"},"step":{"comments":["# 결제 정보"],"background":true,"line":12,"prefix":"*","index":4,"text":"def amount = 539"}},{"result":{"nanos":734900,"millis":0.7349,"status":"passed"},"step":{"background":true,"line":13,"prefix":"*","index":5,"text":"def currency = \"TWD\""}},{"result":{"nanos":734700,"millis":0.7347,"status":"passed"},"step":{"background":true,"line":14,"prefix":"*","index":6,"text":"def lpAccountNo = \"1000110002462537\""}},{"result":{"nanos":820400,"millis":0.8204,"status":"passed"},"step":{"comments":["# set channelId & channelSecretKey - pay_test_tw001"],"background":true,"line":16,"prefix":"*","index":7,"text":"def channelId = \"1651833220\""}},{"result":{"nanos":826800,"millis":0.8268,"status":"passed"},"step":{"background":true,"line":17,"prefix":"*","index":8,"text":"def channelSecretKey = \"4825631fee1f0ceaacffd2a3f1578413\""}},{"result":{"nanos":1162200,"millis":1.1622,"status":"passed"},"step":{"comments":["# MKTP DATA"],"background":true,"line":21,"prefix":"*","index":9,"text":"def mktURI = \"http:\/\/sparrow-api-pay.line-apps-beta.com:14404\/internal\""}},{"result":{"nanos":573900,"millis":0.5739,"status":"passed"},"step":{"background":true,"line":22,"prefix":"*","index":10,"text":"def merchantID = \"test-QAtailoff03\""}},{"result":{"nanos":537200,"millis":0.5372,"status":"passed"},"step":{"background":true,"line":23,"prefix":"*","index":11,"text":"def applySeq = 26440"}},{"result":{"nanos":1329100,"millis":1.3291,"status":"passed"},"step":{"comments":["# set channelId & channelSecretKey - LINEPAY_MKT1"],"background":true,"line":26,"prefix":"*","index":12,"text":"def channelId = \"1651851137\""}},{"result":{"nanos":413700,"millis":0.4137,"status":"passed"},"step":{"background":true,"line":27,"prefix":"*","index":13,"text":"def channelSecretKey = \"92b9ed57d04cca448beca0652ef0bd34\""}},{"result":{"nanos":422000,"millis":0.422,"status":"passed"},"step":{"comments":["#\t## -----MKTP----- ##","#\t## Order - Calculation ##","#\t* def path = \"\/v1\/TW\/order\"","#\t* def req_header =","#\"\"\"","#{","#\t\t X-LP-MK-MERCHANT-ID : #(merchantID)","#}","#\"\"\"","#* def req_body =","#\t    \"\"\"","#\t    {","#\t      \"applySeq\": #(applySeq)","#\t    }","#\t    \"\"\"","#\t  Given url mktURI + path","#\t\tAnd headers req_header","#\t\tAnd request req_body","#\t\tWhen method POST","#Then status 200","#And match response.resultCode == \"0000\"","#","#\t* def tempOrderSeq = response.data.tempOrderSeq","#","#\t## Order - Payment Request ##","#\t\t* def path = \"\/v1\/TW\/order\/\" + tempOrderSeq + \"\/payment\/request\"","#\t* def req_header =","#\"\"\"","#{","#\t\t X-LP-MK-MERCHANT-ID : #(merchantID)","#}","#\"\"\"","#* def req_body =","#\t    \"\"\"","#\t    {","#\t      \"paymentType\": \"LINE_PAY\"","#\t    }","#\t    \"\"\"","#* def orderId = 'ORD_' + Java.type('Utils.PaymentUtil').generateOrderId()","#","#\t  Given url mktURI + path","#\t\tAnd headers req_header","#\t\tAnd request req_body","#\t\tWhen method POST","#Then status 200","#And match response.resultCode == \"0000\"","#","#\t* def transactionId = response.data.transactionId","#And Java.type('Utils.PaymentUtil').setVar(\"transactionReserveId\", response.data.paymentUrl.web)","## Request payment ##"],"line":81,"prefix":"*","index":0,"text":"def path = \"\/v3\/payment\/request\/get\""}},{"result":{"nanos":44684600,"millis":44.6846,"status":"passed"},"step":{"line":82,"prefix":"*","index":1,"text":"def transactionReserveId = Java.type('Utils.MktpUtil').getTransactionReserveId()"}},{"result":{"nanos":1531000,"millis":1.531,"status":"passed"},"step":{"endLine":89,"line":83,"prefix":"*","docString":"{\n\t\t X-LP-MID : #(mid),\n    X-LP-ClientInfo : \"ANDROID_BETA\t12.18.0\tAndroid OS\t12\"\n}","index":2,"text":"def req_header ="}},{"result":{"nanos":567100,"millis":0.5671,"status":"passed"},"step":{"endLine":95,"line":90,"prefix":"*","docString":"{\n  \"transactionReserveId\": #(transactionReserveId)\n}","index":3,"text":"def req_body ="}},{"result":{"nanos":6371800,"millis":6.3718,"status":"passed"},"step":{"line":98,"prefix":"Given","index":4,"text":"url baseURI + path"}},{"result":{"nanos":12736100,"millis":12.7361,"status":"passed"},"step":{"line":99,"prefix":"And","index":5,"text":"headers req_header"}},{"result":{"nanos":307600,"millis":0.3076,"status":"passed"},"step":{"line":100,"prefix":"And","index":6,"text":"request req_body"}},{"result":{"nanos":500995300,"millis":500.9953,"status":"passed"},"step":{"line":101,"prefix":"When","index":7,"text":"method POST"}},{"result":{"nanos":1127900,"millis":1.1279,"status":"passed"},"step":{"line":102,"prefix":"Then","index":8,"text":"status 200"}},{"result":{"nanos":10609000,"millis":10.609,"status":"passed"},"step":{"line":103,"prefix":"And","index":9,"text":"match response.returnCode == \"0000\""}},{"result":{"nanos":901700,"millis":0.9017,"status":"passed"},"step":{"comments":["#And match response.info.cancelUrl != null","## Payment ##","# token 발급"],"line":108,"prefix":"*","index":10,"text":"def path = \"\/v1\/line-users\/\" + mid + \"\/tokens\/issue\""}},{"result":{"nanos":216000,"millis":0.216,"status":"passed"},"step":{"line":109,"prefix":"Given","index":11,"text":"url baseURI + path"}},{"result":{"nanos":124615700,"millis":124.6157,"status":"passed"},"step":{"line":110,"prefix":"When","index":12,"text":"method GET"}},{"result":{"nanos":26000,"millis":0.026,"status":"passed"},"step":{"line":111,"prefix":"Then","index":13,"text":"status 200"}},{"result":{"nanos":862200,"millis":0.8622,"status":"passed"},"step":{"line":112,"prefix":"And","index":14,"text":"match response.returnCode == \"0000\""}},{"result":{"nanos":6090900,"millis":6.0909,"status":"passed"},"step":{"line":113,"prefix":"And","index":15,"text":"match response.info.requestToken != null"}},{"result":{"nanos":1301300,"millis":1.3013,"status":"passed"},"step":{"line":114,"prefix":"*","index":16,"text":"def requestToken = response.info.requestToken"}},{"result":{"nanos":2950500,"millis":2.9505,"status":"passed"},"step":{"comments":["# RSA KEY 발급 및 password encrypt"],"line":117,"prefix":"*","index":17,"text":"def password = Java.type('Utils.PaymentUtil').getPassword()"}},{"result":{"nanos":697200,"millis":0.6972,"status":"passed"},"step":{"endLine":123,"line":118,"prefix":"*","docString":"{\n  data: #(password)\n}","index":18,"text":"def payload ="}},{"result":{"nanos":450100,"millis":0.4501,"status":"passed"},"step":{"line":124,"prefix":"*","index":19,"text":"def path = \"\/v1\/rsa\/encrypt\""}},{"result":{"nanos":274300,"millis":0.2743,"status":"passed"},"step":{"line":125,"prefix":"Given","index":20,"text":"url baseURI + path"}},{"result":{"nanos":142800,"millis":0.1428,"status":"passed"},"step":{"line":126,"prefix":"And","index":21,"text":"request payload"}},{"result":{"nanos":147313700,"millis":147.3137,"status":"passed"},"step":{"line":127,"prefix":"When","index":22,"text":"method post"}},{"result":{"nanos":14200,"millis":0.0142,"status":"passed"},"step":{"line":128,"prefix":"Then","index":23,"text":"status 200"}},{"result":{"nanos":1427600,"millis":1.4276,"status":"passed"},"step":{"line":129,"prefix":"And","index":24,"text":"match response.returnCode == \"0000\""}},{"result":{"nanos":360400,"millis":0.3604,"status":"passed"},"step":{"line":130,"prefix":"And","index":25,"text":"match response.info.encryptedText != null"}},{"result":{"nanos":357400,"millis":0.3574,"status":"passed"},"step":{"line":131,"prefix":"And","index":26,"text":"match response.info.keyName != null"}},{"result":{"nanos":918900,"millis":0.9189,"status":"passed"},"step":{"line":132,"prefix":"*","index":27,"text":"def password =  response.info.encryptedText"}},{"result":{"nanos":596800,"millis":0.5968,"status":"passed"},"step":{"line":133,"prefix":"*","index":28,"text":"def keyName = response.info.keyName"}},{"result":{"nanos":364800,"millis":0.3648,"status":"passed"},"step":{"comments":["# 본 API 호출"],"line":136,"prefix":"*","index":29,"text":"def path = \"\/v3\/payment\/request\/authorize\""}},{"result":{"nanos":248900,"millis":0.2489,"status":"passed"},"step":{"endLine":144,"line":137,"prefix":"*","docString":"{\n  X-LP-MID: #(mid),\n  X-LP-ClientInfo : \"ANDROID_BETA\t11.10.2\tAndroid OS\t10\",\n  x-lp-region : \"TW\"\n}","index":30,"text":"def req_header ="}},{"result":{"nanos":1208900,"millis":1.2089,"status":"passed"},"step":{"endLine":163,"line":145,"prefix":"*","docString":"{\n  \"transactionReserveId\" : #(transactionReserveId),\n  \"keyName\" : #(keyName),\n  \"password\" : #(password),\n  \"requestToken\" : #(requestToken),\n  \"payments\":[{\n      \"amount\":\"539\",\n      \"currency\":\"TWD\",\n      \"method\":\"CREDIT_CARD\",\n      \"lpAccountNo\": #(lpAccountNo)\n   }],\n  \"additionalAgreements\": [{\n    \"type\":\"LINE_PAY_OA\",\n    \"checkYn\" : \"Y\"\n  }]\n}","index":31,"text":"def req_body ="}},{"result":{"nanos":143600,"millis":0.1436,"status":"passed"},"step":{"line":164,"prefix":"Given","index":32,"text":"url baseURI + path"}},{"result":{"nanos":124200,"millis":0.1242,"status":"passed"},"step":{"line":165,"prefix":"And","index":33,"text":"headers req_header"}},{"result":{"nanos":85100,"millis":0.0851,"status":"passed"},"step":{"line":166,"prefix":"And","index":34,"text":"request req_body"}},{"result":{"nanos":214214600,"millis":214.2146,"status":"passed"},"step":{"line":167,"prefix":"When","index":35,"text":"method post"}},{"result":{"nanos":19600,"millis":0.0196,"status":"passed"},"step":{"line":168,"prefix":"Then","index":36,"text":"status 200"}},{"result":{"nanos":626300,"millis":0.6263,"status":"passed"},"step":{"line":169,"prefix":"And","index":37,"text":"match response.returnCode == \"0000\""}},{"result":{"nanos":608200,"millis":0.6082,"status":"passed"},"step":{"comments":["## Calculate Amount ##"],"line":172,"prefix":"*","index":38,"text":"def path = \"\/v3\/payment\/request\/calculate\""}},{"result":{"nanos":252400,"millis":0.2524,"status":"passed"},"step":{"endLine":179,"line":173,"prefix":"*","docString":"{\n  X-LP-MID: #(mid),\n  X-LP-ClientInfo : \"ANDROID_BETA\t12.18.0\tAndroid OS\t12\"\n}","index":39,"text":"def req_header ="}},{"result":{"nanos":342300,"millis":0.3423,"status":"passed"},"step":{"endLine":185,"line":180,"prefix":"*","docString":"{\n  \"transactionReserveId\" : #(transactionReserveId)\n}","index":40,"text":"def req_body ="}},{"result":{"nanos":207300,"millis":0.2073,"status":"passed"},"step":{"line":186,"prefix":"Given","index":41,"text":"url baseURI + path"}},{"result":{"nanos":131600,"millis":0.1316,"status":"passed"},"step":{"line":187,"prefix":"And","index":42,"text":"headers req_header"}},{"result":{"nanos":49000,"millis":0.049,"status":"passed"},"step":{"line":188,"prefix":"And","index":43,"text":"request req_body"}},{"result":{"nanos":145260700,"millis":145.2607,"status":"passed"},"step":{"line":189,"prefix":"When","index":44,"text":"method post"}},{"result":{"nanos":13900,"millis":0.0139,"status":"passed"},"step":{"line":190,"prefix":"Then","index":45,"text":"status 200"}},{"result":{"nanos":417100,"millis":0.4171,"status":"passed"},"step":{"line":191,"prefix":"And","index":46,"text":"match response.returnCode == \"0000\""}},{"result":{"nanos":288300,"millis":0.2883,"status":"passed"},"step":{"line":192,"prefix":"And","index":47,"text":"match response.info.productAmount.amount == amount"}},{"result":{"nanos":5011981700,"millis":5011.9817,"status":"passed"},"step":{"line":193,"prefix":"Then","index":48,"text":"Java.type('Utils.PaymentUtil').pause(5000)"}},{"result":{"nanos":933600,"millis":0.9336,"status":"passed"},"step":{"comments":["## Get authorization ##"],"line":196,"prefix":"*","index":49,"text":"def path = \"\/v3\/payment\/authorization\/get\""}},{"result":{"nanos":417200,"millis":0.4172,"status":"passed"},"step":{"endLine":203,"line":197,"prefix":"*","docString":"{\n  X-LP-MID: #(mid),\n  X-LP-ClientInfo : \"ANDROID_BETA\t12.18.0\tAndroid OS\t12\"\n}","index":50,"text":"def req_header ="}},{"result":{"nanos":235700,"millis":0.2357,"status":"passed"},"step":{"endLine":209,"line":204,"prefix":"*","docString":"{\n  \"transactionReserveId\" : #(transactionReserveId)\n}","index":51,"text":"def req_body ="}},{"result":{"nanos":171300,"millis":0.1713,"status":"passed"},"step":{"line":210,"prefix":"Given","index":52,"text":"url baseURI + path"}},{"result":{"nanos":98500,"millis":0.0985,"status":"passed"},"step":{"line":211,"prefix":"And","index":53,"text":"headers req_header"}},{"result":{"nanos":60800,"millis":0.0608,"status":"passed"},"step":{"line":212,"prefix":"And","index":54,"text":"request req_body"}},{"result":{"nanos":779449200,"millis":779.4492,"status":"passed"},"step":{"line":213,"prefix":"When","index":55,"text":"method post"}},{"result":{"nanos":18700,"millis":0.0187,"status":"passed"},"step":{"line":214,"prefix":"Then","index":56,"text":"status 200"}},{"result":{"nanos":481100,"millis":0.4811,"status":"passed"},"step":{"line":215,"prefix":"And","index":57,"text":"match response.returnCode == \"0000\""}},{"result":{"nanos":698800,"millis":0.6988,"status":"passed"},"step":{"comments":["## Confirm authorization ##"],"line":218,"prefix":"*","index":58,"text":"def path = \"\/v3\/payment\/authorization\/confirm\""}},{"result":{"nanos":387200,"millis":0.3872,"status":"passed"},"step":{"endLine":225,"line":219,"prefix":"*","docString":"{\n\t\t X-LP-MID : #(mid),\n    X-LP-ClientInfo : \"ANDROID_BETA\t12.18.0\tAndroid OS\t12\"\n}","index":59,"text":"def req_header ="}},{"result":{"nanos":285400,"millis":0.2854,"status":"passed"},"step":{"endLine":231,"line":226,"prefix":"*","docString":"{\n  \"transactionReserveId\" : #(transactionReserveId)\n}","index":60,"text":"def req_body ="}},{"result":{"nanos":104700,"millis":0.1047,"status":"passed"},"step":{"line":232,"prefix":"Given","index":61,"text":"url baseURI + path"}},{"result":{"nanos":71700,"millis":0.0717,"status":"passed"},"step":{"line":233,"prefix":"And","index":62,"text":"headers req_header"}},{"result":{"nanos":94400,"millis":0.0944,"status":"passed"},"step":{"line":234,"prefix":"And","index":63,"text":"request req_body"}},{"result":{"nanos":471562600,"millis":471.5626,"status":"passed"},"step":{"line":235,"prefix":"When","index":64,"text":"method post"}},{"result":{"nanos":25300,"millis":0.0253,"status":"passed"},"step":{"line":236,"prefix":"Then","index":65,"text":"status 200"}},{"result":{"nanos":713800,"millis":0.7138,"status":"passed"},"step":{"line":237,"prefix":"And","index":66,"text":"match response.returnCode == \"0000\""}},{"result":{"nanos":15772200,"errorMessage":"js failed:\n>>>>\n01: \"\/v1\/TW\/order\/\" + tempOrderSeq + \"\/payment\/confirm\"\n<<<<\norg.graalvm.polyglot.PolyglotException: ReferenceError: \"tempOrderSeq\" is not defined\n- <js>.:program(Unnamed:1)\n\nclasspath:features\/Payment.feature:241","millis":15.7722,"status":"failed"},"step":{"comments":["## MKTP Confirm Payment ##"],"line":241,"prefix":"*","index":67,"text":"def path = \"\/v1\/TW\/order\/\" + tempOrderSeq + \"\/payment\/confirm\""}},{"result":{"nanos":0,"millis":0.0,"status":"skipped"},"step":{"endLine":247,"line":242,"prefix":"*","docString":"{\n  X-LP-MK-MERCHANT-ID : #(merchantID)\n}","index":68,"text":"def req_header ="}},{"result":{"nanos":0,"millis":0.0,"status":"skipped"},"step":{"endLine":254,"line":248,"prefix":"*","docString":"{\n \"amount\": 539,\n \"currency\": \"TWD\"\n}","index":69,"text":"text req_body ="}},{"result":{"nanos":0,"millis":0.0,"status":"skipped"},"step":{"line":255,"prefix":"*","index":70,"text":"def nonce = Java.type('Utils.PaymentUtil').getNonce()"}},{"result":{"nanos":0,"millis":0.0,"status":"skipped"},"step":{"line":256,"prefix":"*","index":71,"text":"def signature = Java.type('Utils.PaymentUtil').getSignature(channelSecretKey, path, req_body, nonce)"}},{"result":{"nanos":0,"millis":0.0,"status":"skipped"},"step":{"line":257,"prefix":"Given","index":72,"text":"url mktURI + path"}},{"result":{"nanos":0,"millis":0.0,"status":"skipped"},"step":{"line":258,"prefix":"And","index":73,"text":"headers req_header"}},{"result":{"nanos":0,"millis":0.0,"status":"skipped"},"step":{"line":259,"prefix":"And","index":74,"text":"request req_body"}},{"result":{"nanos":0,"millis":0.0,"status":"skipped"},"step":{"line":260,"prefix":"When","index":75,"text":"method post"}},{"result":{"nanos":0,"millis":0.0,"status":"skipped"},"step":{"line":261,"prefix":"Then","index":76,"text":"status 200"}},{"result":{"nanos":0,"millis":0.0,"status":"skipped"},"step":{"line":262,"prefix":"And","index":77,"text":"match response.resultCode == \"0000\""}}],"line":28,"description":"","durationMillis":7639.2824,"failed":true,"error":"js failed:\n>>>>\n01: \"\/v1\/TW\/order\/\" + tempOrderSeq + \"\/payment\/confirm\"\n<<<<\norg.graalvm.polyglot.PolyglotException: ReferenceError: \"tempOrderSeq\" is not defined\n- <js>.:program(Unnamed:1)\n\nclasspath:features\/Payment.feature:241","executorName":"main","name":"Credit card 전액결제 \/ 자동 매입 > 전체환불","startTime":1673342959056,"refId":"[1:28]","endTime":1673342966710,"exampleIndex":-1}],"callDepth":0,"name":"MKTP Payment","description":"","resultDate":"2023-01-10 06:29:26 PM","durationMillis":7639.2824,"passedCount":0}